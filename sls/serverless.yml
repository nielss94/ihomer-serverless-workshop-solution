service: crypto-exchange
useDotenv: true

frameworkVersion: '3'

provider:
    name: aws
    runtime: nodejs12.x
    lambdaHashingVersion: 20201221
    stage: dev
    region: ${env:REGION}
    apiGateway:
        shouldStartNameWithService: true

functions:
    getCoins:
        handler: src/handlers/getCoins.handler
    getFiat:
        handler: src/handlers/getFiat.handler
    getPortfolio:
        handler: src/handlers/getPortfolio.handler
    depositFiat:
        handler: src/handlers/depositFiat.handler
    buy:
        handler: src/handlers/buy.handler
    sell:
        handler: src/handlers/sell.handler

custom:
    appSync:
        name: api
        authenticationType: API_KEY
        schema:
#            - graphql/_mutation.graphql
            - graphql/_query.graphql
            - graphql/types.graphql
        dataSources:
            -   type: AWS_LAMBDA
                name: getPortfolio
                config:
                    functionName: getPortfolio
        mappingTemplates:
            -   dataSource: getPortfolio
                type: Query
                field: getPortfolio
                request: false
                response: false

    appsync-simulator:
        apiKey: 0123456789
        location: .build
        watch: false


package:
    patterns:
        - 'graphql/**'

plugins:
    - serverless-plugin-typescript
    - serverless-appsync-simulator
    - serverless-offline
